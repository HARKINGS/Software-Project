<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/global.css" />
    <link rel="stylesheet" href="/css/List_Account.css" />
    <title>Quản lý tài khoản</title>
  </head>
  <body>
    <div class="fullscreen">
      <div class="Dashboard">
        <a style="color: #4081f1" onclick="window.location.href = '/admin/Home'"
          >Chung cư BlueMoon</a
        >
        <div class="Dashboard__elements">
          <a onclick="window.location.href = '/admin/List_Resident'"
            >Thông tin dân cư</a
          >
        </div>
        <div class="Dashboard__elements">
          <a onclick="window.location.href = '/admin/List_House_Hold'"
            >Thông tin hộ khẩu</a
          >
        </div>
        <div class="Dashboard__elements">
          <a onclick="window.location.href = '/admin/List_Fee'"
            >Thông tin thu phí</a
          >
        </div>
        <div class="Dashboard__elements">
          <a onclick="window.location.href = '/admin/DonationLedger'"
            >Đóng góp tình nguyện</a
          >
        </div>
        <div class="Dashboard__elements">
          <a onclick="window.location.href = '/admin/List_Account'"
            >Quản lý tài khoản</a
          >
        </div>
        <div class="Dashboard__elements">
          <a onclick="window.location.href = '/admin/Settings_ADMIN'"
            >Cài đặt</a
          >
        </div>
      </div>
      <div class="Main">
        <h1>Quản lý tài khoản</h1>
        <div class="Search-Acc">
          <div class="Search-Acc-Item">
            <label for="nameAccount" class="label">Tên tài khoản:</label>
            <input
              id="nameAccount"
              class="input"
              placeholder="Nhập tên tài khoản"
              oninput="filterData()"
            />
          </div>
          <div class="Search-Acc-Item">
            <label for="userID" class="label">Mã cư dân:</label>
            <input
              id="userID"
              class="input"
              placeholder="Nhập mã cư dân"
              oninput="filterData()"
            />
          </div>
        </div>

        <table id="AccountTable">
          <thead>
            <tr>
              <th>Tên tài khoản</th>
              <th>Mật khẩu</th>
              <th>Mã cư dân</th>
              <th>Hành động</th>
            </tr>
          </thead>
          <tbody>
            <!-- Rows dynamically generated -->
          </tbody>
        </table>
      </div>
    </div>

    <script>
      let accounts = [
        { username: "admin", password: "admin123", userID: "H001" },
        { username: "user1", password: "password1", userID: "H002" },
        { username: "user2", password: "password2", userID: "H003" },
        { username: "user3", password: "password3", userID: "H004" },
      ];

      // Khởi tạo bảng với dữ liệu mẫu khi tải trang
      document.addEventListener("DOMContentLoaded", () => {
        renderTable(accounts);
      });

      function filterData() {
        const nameFilter = document
          .getElementById("nameAccount")
          .value.toLowerCase();
        const userIDFilter = document
          .getElementById("userID")
          .value.toLowerCase();

        const filteredData = accounts.filter(
          (account) =>
            account.username.toLowerCase().includes(nameFilter) &&
            account.userID.toLowerCase().includes(userIDFilter)
        );

        renderTable(filteredData);
      }

      function addRow() {
        const username = document.getElementById("addUsername").value.trim();
        const password = document.getElementById("addPassword").value.trim();
        const userID = document.getElementById("addUserID").value.trim();

        if (username && password && userID) {
          accounts.push({ username, password, userID });
          renderTable(accounts);
          document.getElementById("addUsername").value = "";
          document.getElementById("addPassword").value = "";
          document.getElementById("addUserID").value = "";
        } else {
          alert("Vui lòng điền đầy đủ thông tin!");
        }
      }

      function deleteRow(index) {
        accounts.splice(index, 1);
        renderTable(accounts);
      }

      function renderTable(data) {
        const tbody = document.querySelector("#AccountTable tbody");
        tbody.innerHTML = `
          <tr class="add-row">
            <td><input type="text" id="addUsername" class="input" placeholder="Tên tài khoản" /></td>
            <td><input type="password" id="addPassword" class="input" placeholder="Mật khẩu" /></td>
            <td><input type="text" id="addUserID" class="input" placeholder="Mã cư dân" /></td>
            <td><button onclick="addRow()">Thêm</button></td>
          </tr>
        `;

        data.forEach((account, index) => {
          tbody.innerHTML += `
            <tr>
              <td>${account.username}</td>
              <td>${account.password}</td>
              <td>${account.userID}</td>
              <td>
                <button onclick="deleteRow(${index})">Xóa</button>
                <button onclick="editRow(${index})">Sửa</button>
              </td>
            </tr>
          `;
        });
      }

      function editRow(index) {
        const row = document.querySelectorAll("#AccountTable tbody tr")[
          index + 1
        ]; // +1 vì hàng đầu tiên là form thêm tài khoản
        const account = accounts[index];

        // Chuyển các ô thành input để chỉnh sửa
        row.innerHTML = `
    <td><input type="text" value="${account.username}" class="input edit-username" /></td>
    <td><input type="password" value="${account.password}" class="input edit-password" /></td>
    <td><input type="text" value="${account.userID}" class="input edit-userID" /></td>
    <td>
      <button onclick="saveRow(${index})">Lưu</button>
      <button onclick="cancelEdit(${index})">Hủy</button>
    </td>
  `;
      }

      function saveRow(index) {
        const row = document.querySelectorAll("#AccountTable tbody tr")[
          index + 1
        ];
        const newUsername = row.querySelector(".edit-username").value.trim();
        const newPassword = row.querySelector(".edit-password").value.trim();
        const newUserID = row.querySelector(".edit-userID").value.trim();

        if (newUsername && newPassword && newUserID) {
          accounts[index] = {
            username: newUsername,
            password: newPassword,
            userID: newUserID,
          };
          renderTable(accounts);
        } else {
          alert("Vui lòng điền đầy đủ thông tin!");
        }
      }

      function cancelEdit(index) {
        renderTable(accounts); // Khôi phục bảng về trạng thái ban đầu
      }

      document.addEventListener("DOMContentLoaded", () => {
        // Load initial table
        renderTable(accounts);
      });
    </script>
  </body>
</html>
